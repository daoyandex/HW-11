# Домашнее задание к занятию "01 `Базы данных и их типы`" - `Алексеев Александр`

---
### Задание 1. СУБД
Кейс
Крупная строительная компания, которая также занимается проектированием и девелопментом, решила создать правильную архитектуру для работы с данными. Ниже представлены задачи, которые необходимо решить для каждой предметной области.

Какие типы СУБД, на ваш взгляд, лучше всего подойдут для решения этих задач и почему?

#### 1.1. Бюджетирование проектов с дальнейшим формированием финансовых аналитических отчётов и прогнозирования рисков. СУБД должна гарантировать целостность и чёткую структуру данных.
#### Ответ:
При заданных условиях лучше всего подойдет обычная реляционная СУБД.

#### 1.1.* Хеширование стало занимать длительно время, какое API можно использовать для ускорения работы?
#### Ответ:
Возможно применение параллельного хэширования с распределением обработки данных по разным вычислительным ресурсам. С применением древовидных способов работы хэш-функций, либо параллельных хэш-таблиц (позволяют нескольким потокам одновременно обращаться к одной и той же хэш-таблице с использованием хэш-функции).
Другой вариант при использовании PostgreSQL - задействование параллельного алгоритма хеш-соединения. С версии 11 в PostgreSQL используется специальный параллельный алгоритм для больших наборов данных. В нём хеш-таблица создаётся не в локальной памяти процесса, а в общей динамически выделяемой памяти и доступна каждому параллельному процессу, участвующему в соединении. Это позволяет вместо нескольких отдельных хеш-таблиц создать одну общую, используя суммарный объём памяти, доступный всем процессам-участникам. 

#### 1.2. Под каждый девелоперский проект создаётся отдельный лендинг, и все данные по лидам стекаются в CRM к маркетологам и менеджерам по продажам. Какой тип СУБД лучше использовать для лендингов и для CRM? СУБД должны быть гибкими и быстрыми.
#### Ответ:
Для ведения девелоперских проектов, их лендингов подойдет Column-oriented тип СУБД. 
Для ведения CRM традиционно используются реляционные БД, которые позволяют собрать разнообразную аналитику и строить на ее основе отчеты с оценочными числовыми показателями (например, ABC - отчеты, воронки продаж и пр.)

#### 1.2.* Можно ли эту задачу закрыть одной СУБД? И если да, то какой именно СУБД и какой реализацией?
#### Ответ:
Реляционная СУБД может обеспечить хранение и обработку указанных данных, т.к. Column-oriented СУБД является частным подвидом реляционной. В этом случае возможет проигрыш в производительности или масштабируемости (при появлении новых аналитик для лэндинга потребуется труктурная доработка всей БД).

#### 1.3. Отдел контроля качества решил создать базу по корпоративным нормам и правилам, обучающему материалу и так далее, сформированную согласно структуре компании. СУБД должна иметь простую и понятную структуру.
#### Ответ:
в частном случае возможно подойдет документо-ориентированная СУБД. В качестве ключей возможно указание структурных подразделений организации, а также области / назначения документов, одним из ключей может быть ссылка на путь хранения документа на файловом хранилище. Также подойдет и реляционная модель.

#### 1.3.* Можно ли под эту задачу использовать уже существующую СУБД из задач выше и если да, то как лучше это реализовать?
#### Ответ:
да, на базе реляционной модели вполне возможно добавление ряда таблиц, описывающих НСИ для аналитик по документации, и некой таблицы, где кортеж будет представлять собой свод данных по конкретному документу (правилу, стандарту и пр.) с указанием принадлежности к конкретному структурному подразделению.

#### 1.4. Департамент логистики нуждается в решении задач по быстрому формированию маршрутов доставки материалов по объектам и распределению курьеров по маршрутам с доставкой документов. СУБД должна уметь быстро работать со связями.
#### Ответ:
в отдельном частном случае подойдет СУБД графового типа, где в качестве узлов - объекты, куда осуществляется доставка. Решение задачи графа в этом случае даст оптимальный маршрут доставки материала / маршрута курьера.

#### 1.4.* Можно ли к этой СУБД подключить отдел закупок или для них лучше сформировать свою СУБД в связке с СУБД логистов?
#### Ответ:
"нет такого обладателя единой БД, который бы не мечтал разделить ее на несколько, и нет такого обладателя нескольких БД, который бы не мечтал объединить их". Думаю, решение будет зависеть от фактических объемов данных и пользователей. Вероятно лучшим решением будет сформировать отдельную СУБД со своей БД отдела закупок и интегрировать ее с БД логистов. Впрочем, соверменные файловые системы и СУБД, а также бизнес-приложения к ним, вполне позволяют и высоконагруженные базы данных размещать в рамках одной СУБД и одной БД, работающей в клиент-серверной модели.

#### 1.5.* Можно ли все перечисленные выше задачи решить, используя одну СУБД? Если да, то какую именно?
#### Ответ: 
Да, реляционную.

Приведите ответ в свободной форме.

### Задание 2. Транзакции
#### 2.1. Пользователь пополняет баланс счёта телефона, распишите пошагово, какие действия должны произойти для того, чтобы транзакция завершилась успешно. Ориентируйтесь на шесть действий.
#### Ответ: Рассматриваем вариант безналичного пополнения баланса со счета в банке. Счет пользователя в банке не может стать отрицательным ни в какой момент времени.
1. Пользователь отдает распоряжение банку на списание с его счета нужной суммы.
2. Банк фиксирует остаток на счете пользователя и проверяет его достаточность для списания требуемой суммы.
3. Банк списывает средства со счета пользователя - в некий буфер. После этой операции счет банковский пользователя доступен для прочих операций.
4. Банк осуществляет запрос на зачисление средств на счет пользователя у мобильного оператора. В рамках этого запроса производится проверка актуальности счета пользователя у мобильного оператора (доступность к операции зачисления средств).
5. После получения подтверждения актуальности счета пользователя банк производит перевод на счет у мобильного оператора и получает подтверждение о выполнении зачисления переводимых средств.
6. Банк передает Пользователю подтверждение о зачислении переводимых средств. 
На этом транзакция считается успешно завершенной.
В случае отсутствия подтверждения успешности какого-либо из указанных шагов, транзакция отменяется и средства из буфера банка возвращаются на счет Пользователя. В случае аварии в п.5 производится взаимное согласование ситуации между банком, мобильным оператором, и, возможно, расчетным (клиринговым центром), и далее- либо средства возвращаются банку - и обратно Пользователю, либо транзакция успешно разрешается с зачислением средств на счет мобильного оператора.

#### 2.1.* Какие действия должны произойти, если пополнение счёта телефона происходило бы через автоплатёж?
Приведите ответ в свободной форме.
#### Ответ:
Автоплатеж подразумевает наличие соответствующего распоряжения от Пользователя о списании средств в счет мобильного оператора при наличии соответствующего платежного требования, а также контроль остатка счета Пользователя на стороне мобильного оператора. В случае достижения некой критической минимальной отметки на счете Пользователя (не обязательно нулевой) мобильный оператор выставляет банку Пользователя платежное требование с указанием нужной суммы пополнения баланса. 
Далее см. ответ по п.2.1, начиная с п.2.


### Задание 3. SQL vs NoSQL
#### 3.1. Напишите пять преимуществ SQL-систем по отношению к NoSQL.
#### Ответ:
1. Atomicity (атомарность) - способность ряд действий (транзакцию) с данными в базе совершать как одно целое, что исключает появление промежуточных, незавершенных состояний.
2. Consistency (согласованность данных) - это понятие относится к логике бизнес-процессов, реализуемых операциями в базе данных. Согласованность подразумевает непротиворечивость данных, получаемых в БД после завершения или отмены в ней атомарных транзакционных блоков операций. 
3. Isolation (изолированность транзакций друг от друга) - при выполнении текущей транзакции параллельные транзакции не должны оказывать влияния на её результат. Существует 4 негативных эффекта, по совокупности купирования которых различаются уровни изоляций транзакций в СУБД. В целом свойство Изолированности обеспечивает параллельность обработки транзакций в системе и непротиворечивость фиксируемых при этом данных в системе (см. Согласованность).
4. Durability - подтвержденная выполненная транзакция свидетельствует о закреплении нового состояния данных в ЮД, которое стабильно и не зависит от последующих сбоев в системе БД.
5. Предыдущие 4 свойства, выведенные как преимущества, в целом являются базовыми принципами (гарантиями) работы Баз данных. И в своей совокупности они на достаточно высоком уровне могут быть реализованы именно в реляционных СУБД.
Пятым свойством - преимуществом реляционных СУБД можно назвать унификацию механизмов работы со структурой БД: типы данных, которыми можно оперировать, методы формирования таблиц и их полей (реквизитов). И вследствие этого - унификацию методов работы с данными (единый язык запросов и общие способы компоновки результатов запросов).


#### 3.1.* Какие, на ваш взгляд, преимущества у NewSQL систем перед SQL и NoSQL.
#### Ответ:
NewSQL — это современная реляционная система баз данных, которая заполняет пробел между SQL и NoSQL. Базы данных NewSQL нацелены на масштабирование - горизонтальное и вертикальное, что сложно для традиционных систем SQL, а также и сохранение согласованности, что сложно для систем NoSQL. Для систем SQL горизонтальное масштабирование осложнено вопросами репликации данных в новые добавленные узлы, а вертикальное масштабирование требует высоких расходов для формирования мощных вычислительных серверов для поддержания большой общей базы данных.


Приведите ответ в свободной форме.

### Задание 4. Кластеры
Необходимо производить большое количество вычислений при работе с огромным количеством данных, под эту задачу выделено 1000 машин.
На основе какого критерия будете выбирать тип СУБД и какая модель распределённых вычислений здесь справится лучше всего и почему?
Приведите ответ в свободной форме.
#### Ответ: 
**Отноcительно типа СУБД:**
Для больших систем, обрабатывающих важные данные (например, финансовые системы, системы обработки заказов), требуются БД, которые могут по объему обрабатываемых потоков данных превосходить возможности обычных реляционных баз данных.
Но при этом сохраняются транзакционные требования и требования к согласованности, которые непрактичны и труднореализуемы для систем NoSQL. Варианты, которые ранее были доступны для таких организаций, были либо покупка более мощных компьютеров, либо разработка специального промежуточного программного обеспечения, которое распределяет запросы по обычным СУБД. Оба подхода характеризуются высокими затратами на инфраструктуру и/или затратами на разработку. 
Системы NewSQL являются наилучшим решением в таких случаях. 
**Относительно модели распределенных вычислений:**
Многое зависит от физического расположения этих 1000 машин, сложности алгоритма вычислений, и доступности этим машинам общей сети в любой момент времени.
1. При высокой сложности или объеме вычислений, но возможности их разбиения для выполнения их по частям на различных машинах, вероятно возможно применение модели с параллельными алгоритмами в модели передачи сообщений. При этом машины образуют иерархию, в которой исполняются отдельные части алгоритма на раздельных объемах входных данных с передачей получаемых результатов вверх по иерархии по модели компьютерной сети.
2. Если разбиение алгоритма невозможно и требуется его полное исполнение в рамках одной машины, возможно будет применима модель распределенных алгоритмов с передачей сообщений о результате вычисления над ограниченным объемом данных - в какую-то общую память.
При этом ограничение объема данных, направляемых для вычислений на каждую машину может регулироваться отдельной машиной - балансировщиком (возможно несколькими).

